 <!doctype html>
<html><!-- InstanceBegin template="/Templates/001.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta charset="utf-8">
<!-- InstanceBeginEditable name="doctitle" -->
<title>投标人管理</title>
<!-- InstanceEndEditable -->
<!-- InstanceBeginEditable name="head" -->
<script src="/js/db-connection.js"></script>
<style>
    .container {
        display: flex;
        width: 100%;
        height: 100%;
    }
    .nav-menu {
        width: 140px;
        background: #f5f5f5;
        padding: 10px;
    }
    .nav-item {
        padding: 8px;
        cursor: pointer;
        border-bottom: 1px solid #ddd;
    }
    .nav-submenu {
        display: none;
        padding-left: 9px;
    }
    .nav-submenu-item {
        padding: 5px;
        cursor: pointer;
    }
    .content-area {
        flex: 1;
        padding: 20px;
    }
    .tab-header {
        display: flex;
        border-bottom: 1px solid #ddd;
    }
    .tab-item {
        padding: 10px 20px;
        cursor: pointer;
        border: 1px solid #ddd;
        margin-right: 5px;
        background: #f5f5f5;
    }
    .tab-item.active {
        background: #fff;
        border-bottom: 1px solid #fff;
    }
    .tab-content {
        display: none;
        padding: 20px;
        border: 1px solid #ddd;
        border-top: none;
    }
    .tab-content.active {
        display: block;
    }
    #companyInfoDisplay>div>p p:first-of-type,
    #companyInfoDisplay>p p:first-of-type{
        margin:0 !important;
    }
    #companyInfoDisplay>div>p p,
    #companyInfoDisplay>p p{
        margin: 10px 0 0 0;
    }
</style>
<script>
    function showTab(tabId) {
        // 隐藏所有标签内容
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });
        // 取消所有标签项的active类
        document.querySelectorAll('.tab-item').forEach(item => {
            item.classList.remove('active');
        });
        // 显示选中的标签内容
        const content = document.getElementById(tabId);
        content.classList.add('active');
        // 激活对应的标签项
        document.querySelector(`.tab-item[data-tab="${tabId}"]`).classList.add('active');
    }

    // 为所有标签项添加点击事件
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.tab-item').forEach(item => {
            item.addEventListener('click', function() {
                showTab(this.dataset.tab);
            });
        });

        // 添加项目选择事件
        document.querySelectorAll('.project-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const applyBtn = this.closest('tr').querySelector('.apply-btn');
                applyBtn.disabled = !this.checked;
            });
        });

        // 添加报名按钮事件
        document.querySelectorAll('.apply-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                const projectId = this.closest('tr').querySelector('.project-checkbox').dataset.project;
                window.location.href = 'Application.html?project=' + encodeURIComponent(projectId);
            });
        });
    });

    function showAffairTabs() {
        // 显示综合事务标签页
        document.querySelectorAll('.tab-item').forEach(item => {
            const tabId = item.dataset.tab;
            item.style.display = (tabId === 'project1' || tabId === 'project2' || tabId === 'project3') ? 'none' : 'block';
        });
        // 默认显示可以报名项目
        showTab('available');
    }

    function showApplicationTabs() {
        // 显示项目报名相关标签页
        document.querySelectorAll('.tab-item').forEach(item => {
            const tabId = item.dataset.tab;
            item.style.display = (tabId === 'available' || tabId === 'applying') ? 'block' : 'none';
        });
        // 默认显示可以报名项目
        showTab('available');
    }

    function showProfileTab() {
        // 显示我的信息标签页
        document.querySelectorAll('.tab-item').forEach(item => {
            const tabId = item.dataset.tab;
            item.style.display = (tabId === 'profile') ? 'block' : 'none';
        });
        showTab('profile');
    }

    function showProjectTabs() {
        // 显示项目相关标签页
        document.querySelectorAll('.tab-item').forEach(item => {
            const tabId = item.dataset.tab;
            item.style.display = (tabId === 'project1' || tabId === 'project2' || tabId === 'project3') ? 'block' : 'none';
        });
        showTab('project1');
    }

    // 启用编辑模式
    function enableEditMode() {
        // 从显示区域获取当前值
        document.getElementById('editCompanyName').value = document.getElementById('companyName').textContent;
        document.getElementById('editCreditCode').value = document.getElementById('creditCode').textContent;
        document.getElementById('editContactPerson').value = document.getElementById('contactPerson').textContent;
        document.getElementById('editContactPhone').value = document.getElementById('contactPhone').textContent;
        document.getElementById('editContactEmail').value = document.getElementById('contactEmail').textContent;
        
        // 切换显示/编辑模式
        document.getElementById('companyInfoDisplay').style.display = 'none';
        document.getElementById('companyInfoForm').style.display = 'block';
    }

    // 取消编辑
    function cancelEdit() {
        document.getElementById('companyInfoDisplay').style.display = 'block';
        document.getElementById('companyInfoForm').style.display = 'none';
    }

    // 显示上传对话框
    function showUploadDialog(name) {
        document.getElementById(name).click();
    }

    // 提交企业信息
    function submitCompanyInfo() {
        if(!confirm('是否进行保存，更改后的企业信息会进行审核，审核通过后才可进行报名项目！（不会影响正在报名中项目和已报名成功项目）')) {
            return;
        }
        saveAccount();
    }

    // 初始化显示事务相关标签页
    window.onload = function() {
        showAffairTabs();
        // 确保各内容区域独立
        document.getElementById('profile').innerHTML = document.getElementById('profile').innerHTML;
    };
</script>
<!-- InstanceEndEditable -->
</head>

<body>
    <!-- 不可编辑的顶部区域 -->
    <div style="width:1040px; height:120px; background:#f0f0f0; position:relative; display:flex; justify-content:space-between; align-items:center; padding:0 50px;">
        <div style="font-size:28px; font-weight:bold;">AI智能化评标系统</div>
        <div style="display:flex; gap:30px;">
            <a href="index.html" style="text-decoration:none; color:#333;">返回首页</a>
            <a href="login.html" style="text-decoration:none; color:#333;">登录</a>
            <a href="login-out.html" style="text-decoration:none; color:#333;">退出</a>
        </div>
    </div>
    
    <!-- 可编辑的主要内容区域 -->
    <!-- InstanceBeginEditable name="content" -->
    <div style="width:1040px; min-height:calc(100vh - 120px);">
        <div class="container">
            <div class="nav-menu">
                <div class="nav-item" onclick="showAffairTabs()">我的事务
                    <div class="nav-submenu">
                        <div class="nav-submenu-item" onclick="showAffairTabs()">综合事务</div>
                        <div class="nav-submenu-item" onclick="showApplicationTabs()">项目报名</div>
                        <div class="nav-submenu-item" onclick="showProfileTab()">我的信息</div>
                    </div>
                </div>
                <div class="nav-item" onclick="showProjectTabs()">我的项目</div>
            </div>
            <div class="content-area">
                <div class="tab-header">
                    <div class="tab-item active" data-tab="available">可以报名项目</div>
                    <div class="tab-item" data-tab="applying">正在报名项目</div>
                    <div class="tab-item" id="myInfo" data-tab="profile">我的信息</div>
                    <div class="tab-item" data-tab="project1">已报名项目</div>
                    <div class="tab-item" data-tab="project2">正在进行项目</div>
                    <div class="tab-item" data-tab="project3">评审结束项目</div>
                </div>
                <div class="tab-content active" id="available">
                    <h3>可以报名项目</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        项目名称<input type="text" id="projectNameSearch" style="flex:1; padding:5px;margin: 0 20px 0 5px;" placeholder="支持模糊查询">
                        项目编号<input type="text" id="projectCodeSearch" style="flex:1; padding:5px;margin: 0 20px 0 5px;" placeholder="支持模糊查询">
                        截止时间<input type="date" id="enrollEndDateSearch" style="flex:1; padding:4px;margin: 0 20px 0 5px;" >
                        <button id="searchBtn" style="padding:5px 10px; background:#2196F3; color:#fff; border:none;cursor: pointer;">查询</button>
                    </div>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead id="pageThead2">
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px; border:1px solid #ddd;">项目名称</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目编号</th>
                                <th style="padding:10px; border:1px solid #ddd;">截止时间</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目预算</th>
                                <th style="padding:10px; border:1px solid #ddd;">操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="pageInfo2" style="margin-top:10px; text-align: center;"></div>
                </div>
                <div class="tab-content" id="applying">
                    <h3>正在报名项目</h3>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead id="pageThead">
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px; border:1px solid #ddd;">项目名称</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目编号</th>
                                <th style="padding:10px; border:1px solid #ddd;">报名时间</th>
                                <th style="padding:10px; border:1px solid #ddd;">状态</th>
                                <th style="padding:10px; border:1px solid #ddd;width:100px;">操作</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div id="pageInfo" style="margin-top:10px; text-align: center;"></div>
                </div>
                <div class="tab-content" id="profile">
                    <h3>企业信息<span style="color: red;font-size: 15px;font-weight: normal;curson:pointer;" data-info="" id="accountState"></span></h3>
                    <div id="companyInfoDisplay" style="margin-bottom:20px;">
                        <p><strong>企业名称：</strong><span id="companyName"></span></p>
                        <p><strong>统一社会信用代码：</strong><span id="creditCode"></span></p>
                        <p><strong style="vertical-align: top;">营业执照：</strong><span id="certificateFiles" style="display: inline-block;"></span></p>
                        <p><strong>经办人：</strong><span id="contactPerson"></span></p>
                        <p><strong>联系电话：</strong><span id="contactPhone"></span></p>
                        <p><strong>电子邮箱：</strong><span id="contactEmail"></span></p>
                        <div id="memberType01" style="display: none;">
                            <p><strong>法人：</strong><span id="accountUser"></span></p>
                            <p><strong>法人证件号：</strong><span id="idCard"></span></p>
                            <p><strong style="vertical-align: top;">法人身份证：</strong><span id="qualificationCertificate01Show" style="display: inline-block;"></span></p>
                        </div>
                        <div id="memberType02" style="display: none;">
                            <p><strong>授权代表人：</strong><span id="accountUser2"></span></p>
                            <p><strong>授权代表人证件号：</strong><span id="idCard2"></span></p>
                            <p><strong style="vertical-align: top;">授权代表人身份证：</strong><span id="qualificationCertificate01_01Show" style="display: inline-block;"></span></p>
                            <p><strong style="vertical-align: top;">法人授权函：</strong><span id="qualificationCertificate02Show" style="display: inline-block;"></span></p>
                            <p><strong style="vertical-align: top;">社保记录：</strong><span id="qualificationCertificate03Show" style="display: inline-block;"></span></p>
                        </div>
                        <p><strong>备注：</strong><span id="contactRemark"></span></p>
                        
                        <button onclick="enableEditMode()" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:15px;margin-right:15px;">更改信息</button>
                        <button onclick="myInfoUpdate()" style="padding:8px 16px; background:#2196F3; color:white; border:none; cursor:pointer; margin-top:15px;">刷新审核</button>
                    </div>
                    <form id="companyInfoForm" style="max-width:600px; display:none;" enctype="multipart/form-data">
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">企业名称<span style="color:red;">*</span></label>
                            <input type="text" id="editCompanyName" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">统一社会信用代码<span style="color:red;">*</span></label>
                            <input type="text" id="editCreditCode" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">上传营业执照<span style="color:red;">*</span></label>
                            <button onclick="showUploadDialog('fileUpload')" type="button" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:10px;display: inline-block;vertical-align: top;">上传营业执照</button>
                            <div id="accountCodeFileId" style="display: inline-block;margin-left:10px;">

                            </div>
                            <input id="fileUpload" type="file" style="width:100%; padding:8px; border:1px solid #ddd;display: none;">
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">经办人<span style="color:red;">*</span></label>
                            <input type="text" id="editContactPerson" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">联系电话<span style="color:red;">*</span></label>
                            <input type="tel" id="editContactPhone" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">电子邮箱<span style="color:red;">*</span></label>
                            <input type="email" id="editContactEmail" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="margin-bottom:20px;">
                            <label style="display:block; margin-bottom:5px;">人员身份</label>
                            <label style="margin-right:15px;margin-left: 50px;">
                                <input type="radio" name="memberType" value="0"> 法人
                            </label>
                            <label style="margin-right:15px;margin-left: 30px;">
                                <input type="radio" name="memberType" value="1" > 授权代表人
                            </label>
                        </div>
                        <div id="type1" style="display: none;">
                            <div style="margin-bottom:20px;">
                                <label style="display:block; margin-bottom:5px;">法人姓名<span style="color:red;">*</span></label>
                                <input type="text" name="accountUser" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;box-sizing: border-box;" >
                            </div>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; margin-bottom:5px;">法人证件号<span style="color:red;">*</span></label>
                                <input type="text" name="idCard" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;box-sizing: border-box;" >
                            </div>
                            <div style="margin-bottom:15px;">
                                <label style="display:block; margin-bottom:5px;">上传法人身份证正反面<span style="color:red;">*</span></label>
                                <button onclick="showUploadDialog('fileUpload2')" type="button" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:10px;display: inline-block;vertical-align: top;">上传法人身份证正反面</button>
                                <div id="qualificationCertificate01" style="display: inline-block;margin-left:10px;">

                                </div>
                                <input id="fileUpload2" type="file" multiple style="width:100%; padding:8px; border:1px solid #ddd;display: none;" >
                            </div>
                        </div>

                        <div id="type2" style="display: none;">
                            <div style="margin-bottom:20px;">
                                <label style="display:block; margin-bottom:5px;">授权代表人姓名<span style="color:red;">*</span></label>
                                <input type="text" name="accountUser2" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;box-sizing: border-box;" >
                            </div>
                            <div style="margin-bottom:20px;">
                                <label style="display:block; margin-bottom:5px;">授权代表人证件号<span style="color:red;">*</span></label>
                                <input type="text" name="idCard2" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:5px;box-sizing: border-box;" >
                            </div>
                            <div style="margin-bottom:15px;">
                                <label style="display:block; margin-bottom:5px;">授权代表人身份证正反面<span style="color:red;">*</span></label>
                                <button onclick="showUploadDialog('fileUpload3')" type="button" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:10px;display: inline-block;vertical-align: top;">上传授权代表人身份证正反面</button>
                                <div id="qualificationCertificate01_01" style="display: inline-block;margin-left:10px;">

                                </div>
                                <input id="fileUpload3" type="file" multiple style="width:100%; padding:8px; border:1px solid #ddd;display: none;" >
                            </div>
                            <div style="margin-bottom:15px;">
                                <label style="display:block; margin-bottom:5px;">法人授权函<span style="color:red;">*</span></label>
                                <button onclick="showUploadDialog('fileUpload4')" type="button" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:10px;display: inline-block;vertical-align: top;">上传法人授权函</button>
                                <div id="qualificationCertificate02" multiple style="display: inline-block;margin-left:10px;">

                                </div>
                                <input id="fileUpload4" type="file" style="width:100%; padding:8px; border:1px solid #ddd;display: none;" >
                            </div>
                            <div style="margin-bottom:15px;">
                                <label style="display:block; margin-bottom:5px;">授权代表人在公司最近至少一个月社保<span style="color:red;">*</span></label>
                                <button onclick="showUploadDialog('fileUpload5')" type="button" style="padding:8px 16px; background:#4CAF50; color:white; border:none; cursor:pointer; margin-top:10px;display: inline-block;vertical-align: top;">上传社保记录</button>
                                <div id="qualificationCertificate03" multiple style="display: inline-block;margin-left:10px;">

                                </div>
                                <input id="fileUpload5" type="file" style="width:100%; padding:8px; border:1px solid #ddd;display: none;" >
                            </div>
                        </div>
                        <div style="margin-bottom:15px;">
                            <label style="display:block; margin-bottom:5px;">备注</label>
                            <input type="text" id="remark" style="width:100%; padding:8px; border:1px solid #ddd;" required>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button type="button" onclick="submitCompanyInfo()" style="padding:10px 20px; background:#4CAF50; color:white; border:none; cursor:pointer;">保存</button>
                            <button type="button" onclick="cancelEdit()" style="padding:10px 20px; background:#f44336; color:white; border:none; cursor:pointer;">取消</button>
                        </div>
                    </form>
                </div>
                <!-- 空的application标签页已移除 -->
                <div class="tab-content" id="project1">
                    <h3>已报名项目</h3>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px; border:1px solid #ddd;">项目名称</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目编号</th>
                                <th style="padding:10px; border:1px solid #ddd;">报名时间</th>
                                <th style="padding:10px; border:1px solid #ddd;">状态</th>
                                <th style="padding:10px; border:1px solid #ddd;">操作</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
                <div class="tab-content" id="project2">
                    <h3>正在进行项目</h3>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px; border:1px solid #ddd;">项目名称</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目编号</th>
                                <th style="padding:10px; border:1px solid #ddd;">开始时间</th>
                                <th style="padding:10px; border:1px solid #ddd;">状态</th>
                                <th style="padding:10px; border:1px solid #ddd;">操作</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
                <div class="tab-content" id="project3">
                    <h3>评审结束项目</h3>
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="padding:10px; border:1px solid #ddd;">项目名称</th>
                                <th style="padding:10px; border:1px solid #ddd;">项目编号</th>
                                <th style="padding:10px; border:1px solid #ddd;">结束时间</th>
                                <th style="padding:10px; border:1px solid #ddd;">结果</th>
                                <th style="padding:10px; border:1px solid #ddd;">操作</th>
                            </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- 报名结果弹窗 -->
    <div id="applicationModal2" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); z-index:1000;">
        <div style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border-radius:5px; width:600px; max-height:80vh; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 id="modalTitle2">项目报名情况</h3>
                <button onclick="closeModal2()" style="padding:5px 10px; background:#f44336; color:white; border:none; cursor:pointer; font-size:20px;">×</button>
            </div>
            <table style="width:100%; border-collapse:collapse;">
                <thead>
                <tr style="background:#f5f5f5;">
                    <th style="padding:10px; border:1px solid #ddd;">投标单位</th>
                    <th style="padding:10px; border:1px solid #ddd;">经办人</th>
                    <th style="padding:10px; border:1px solid #ddd;">联系电话</th>
                    <th style="padding:10px; border:1px solid #ddd;">评审结果</th>
                </tr>
                </thead>
                <tbody id="modalApplicationTable2">
                <!-- 模拟数据将通过JavaScript动态填充 -->
                </tbody>
            </table>
            <div style="text-align:center; margin-top:20px;">
                <button onclick="closeModal2()" style="padding:8px 20px; background:#4CAF50; color:white; border:none; cursor:pointer;">关闭</button>
            </div>
        </div>
    </div>
    <script id="availableTemplate" type="text/x-handlebars-template">
        {{#if list}}
        {{#each list}}
            <tr>
                <td style="padding:10px; border:1px solid #ddd;">{{projectName}}</td>
                <td style="padding:10px; border:1px solid #ddd;">{{projectCode}}</td>
                <td style="padding:10px; border:1px solid #ddd;">{{enrollEndDate}}</td>
                <td style="padding:10px; border:1px solid #ddd;">{{#moneyDelimiter money}}{{/moneyDelimiter}}</td>
                <td style="padding:10px; border:1px solid #ddd;">
                    <button onclick="signUp('{{id}}','{{#if descriptionFile}}/file/download/{{descriptionFile}}{{else}}{{/if}}','{{oldSuppliers}}')" style="margin-right:5px;margin-top:5px;padding:5px 10px; background:#4CAF50; color:white; border:none; cursor:pointer; text-decoration:none;">立即报名</button>
                    {{#if descriptionFile}}
                        <a target="_blank" href="/file/download/{{descriptionFile}}" style="margin-right:5px;text-decoration: none;cursor: pointer">
                            <button onclick="javascrip:alert('请仔细阅读附件的廉洁告知书，补充完整登记表信息盖章和报名资料一起在“我的信息”列表中上传！');" style="margin-top:5px;padding:5px 10px; background:red; color:white; border:none; cursor:pointer; text-decoration:none;">告知书或登记表</button>
                        </a>
                    {{/if}}
                </td>
            </tr>
        {{/each}}
        {{else}}
            <tr>
                <td colspan="5" style="padding:10px; border:1px solid #ddd;">没有可以报名项目</td>
            </tr>
        {{/if}}
    </script>
    <script id="applyingTemplate" type="text/x-handlebars-template">
        {{#if list}}
        {{#each list}}
        <tr>
            <td style="padding:10px; border:1px solid #ddd;">{{projectName}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{projectCode}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{projectRegisters.createDate}}</td>
            {{#eq  projectRegisters.state 0}}<td style="padding:10px; border:1px solid #ddd;color:#2196F3;">缴费审核中 </td>{{/eq}}
            {{#eq  projectRegisters.state 1}}<td style="padding:10px; border:1px solid #ddd;">报名成功 </td>{{/eq}}
            {{#eq  projectRegisters.state 2}}<td style="padding:10px; border:1px solid #ddd;color:red;">缴费不通过 </td>{{/eq}}
            {{#eq  projectRegisters.state 3}}<td style="padding:10px; border:1px solid #ddd;color:#2196F3;">信息审核中 </td>{{/eq}}
            {{#eq  projectRegisters.state 4}}<td style="padding:10px; border:1px solid #ddd;color:#4CAF50;">信息通过 </td>{{/eq}}
            {{#eq  projectRegisters.state 5}}<td style="padding:10px; border:1px solid #ddd;color:red;">信息不通过 </td>{{/eq}}
            <td style="padding:10px; border:1px solid #ddd;">
                {{#eq  projectRegisters.state 4}}<!-- 资质通过 -->
                    <button onclick="application('/Application.html?id={{id}}&pid={{projectRegisters.id}}')" style="padding:5px 10px; background:#4CAF50; color:white; border:none; cursor:pointer;font-size: 13px;">报名缴费</button>
                {{else}}
                    <!-- <button onclick="showProgress('{{projectName}}','{{id}}')" style="padding:5px 10px; background:#2196F3; color:white; border:none; cursor:pointer;font-size: 13px;">报名记录</button> -->
                {{/eq}}
                {{#eq  projectRegisters.state 2}}<!-- 报名缴费不通过 -->
                    <button onclick="application('/Application.html?id={{id}}&pid={{projectRegisters.id}}')" style="padding:5px 10px; background:#4CAF50; color:white; border:none; cursor:pointer;font-size: 13px;">重新缴费</button>
                    <button onclick="showProgress()" style="margin-top:5px;padding:5px 10px; background:#2196F3; color:white; border:none; cursor:pointer;font-size: 13px;">退费说明</button>
                    <button onclick="alert('缴费不通过原因：{{projectRegisters.notPassInfo}}')" style="margin-top:5px;padding:5px 10px; background:red; color:white; border:none; cursor:pointer;font-size: 13px;">不通过原因</button>
                {{/eq}}
                {{#eq  projectRegisters.state 5}}<!-- 资质不通过 -->
                    <button onclick="signUp3('{{id}}')" style="padding:5px 10px; background:#4CAF50; color:white; border:none; cursor:pointer; text-decoration:none;">重新审核</button>
                    <button onclick="alert('材料不通过原因：{{projectRegisters.notPassInfo}}')" style="margin-top:5px;padding:5px 10px; background:red; color:white; border:none; cursor:pointer;font-size: 13px;">不通过原因</button>
                {{/eq}}
            </td>
        </tr>
        {{/each}}
        {{else}}
        <tr>
            <td colspan="6" style="padding:10px; border:1px solid #ddd;">没有正在报名项目</td>
        </tr>
        {{/if}}
    </script>
    <script id="project1Template" type="text/x-handlebars-template">
        {{#if list}}
        {{#each list}}
        <tr>
            <td style="padding:10px; border:1px solid #ddd;">{{projectName}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{projectCode}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{senrollStartDate}}</td>
            <td style="padding:10px; border:1px solid #ddd;">已报名</td>
            <td style="padding:10px; border:1px solid #ddd;width: 50px;">
                <a href="/project-d.html?id={{projectRegisters.id}}" style="text-decoration: none;cursor: pointer;">
                    <button style="padding:5px 10px; background:#2196F3; color:white; border:none; cursor:pointer;">查看详情</button>
                </a>
            </td>
        </tr>
        {{/each}}
        {{else}}
        <tr>
            <td colspan="5" style="padding:10px; border:1px solid #ddd;">没有已报名项目</td>
        </tr>
        {{/if}}
    </script>
    <script id="project2Template" type="text/x-handlebars-template">
        {{#if list}}
        {{#each list}}
        <tr>
            <td style="padding:10px; border:1px solid #ddd;">{{projectName}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{projectCode}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{bidOpeningTime}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{#gtNowDate bidOpeningTime}}等待评审{{else}}评审中{{/gtNowDate}}</td>
            <td style="padding:10px; border:1px solid #ddd;width: 50px;">
                {{#gtNowDate bidOpeningTime}}{{else}}
                    <a href="clarify.html?id={{../this.accountId}}&projectId={{id}}" style="text-decoration: none;cursor: pointer">
                        <button style="padding:5px 10px; background:#2196F3; color:white; border:none; cursor:pointer;">进入澄清</button>
                    </a>
                {{/gtNowDate}}
            </td>
        </tr>
        {{/each}}
        {{else}}
        <tr>
            <td colspan="5" style="padding:10px; border:1px solid #ddd;">没有正在进行项目</td>
        </tr>
        {{/if}}
    </script>
    <script id="project3Template" type="text/x-handlebars-template">
        {{#if list}}
        {{#each list}}
        <tr>
            <td style="padding:10px; border:1px solid #ddd;">{{projectName}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{projectCode}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{reviewEndDate}}</td>
            <td style="padding:10px; border:1px solid #ddd;">{{#eq isPass 1}}废标{{else}}{{#eq projectRegisters.winBidState 0}}未公布{{/eq}}{{#eq projectRegisters.winBidState 1}}中标{{/eq}}{{#eq projectRegisters.winBidState 2}}未中标{{/eq}}{{/eq}}</td>
            <td style="padding:10px; border:1px solid #ddd;width: 50px;">
                <button onclick="showApplicationModal2('{{projectName}}','{{id}}')" style="padding:5px 10px; background:#4CAF50; color:white; border:none; cursor:pointer;">查看结果</button>
            </td>
        </tr>
        {{/each}}
        {{else}}
        <tr>
            <td colspan="5" style="padding:10px; border:1px solid #ddd;">没有评审结束项目</td>
        </tr>
        {{/if}}
    </script>

    <script src="plugin/jquery-3.3.1.min.js" type="text/javascript"></script>
    <script src="plugin/handlebars-v4.0.11-dist/handlebars-v4.0.11.min.js" type="text/javascript"></script>
    <script src="plugin/handlebars-v4.0.11-dist/handlebars-ext.js" type="text/javascript"></script>
    <script src="config/token.js" type="text/javascript"></script>
    <script>
        verifyLogin();


        $(function(){
            // 初始化
            availableInit(1,$("#available tbody"),Handlebars.compile($("#availableTemplate").html()));
            // 添加回车键搜索功能
            keypress13("projectNameSearch","searchBtn");
            keypress13("projectCodeSearch","searchBtn");

            $("body").on("click", "div[data-tab=available]", function() {
                localStorage.removeItem('page'); // 分页页码
                localStorage.removeItem('data'); // 搜索参数
                availableInit(1,$("#available tbody"),Handlebars.compile($("#availableTemplate").html()));
            });
            $("body").on("click", "#searchBtn", function() {
                availableInit(1,$("#available tbody"),Handlebars.compile($("#availableTemplate").html()));
            });
            $("body").on("click", "div[data-tab=applying]", function() {
                localStorage.removeItem('page'); // 分页页码
                localStorage.removeItem('data'); // 搜索参数
                applyingInit(1,$("#applying tbody"),Handlebars.compile($("#applyingTemplate").html()));
            });
            $("body").on("click", "div[data-tab=project1]", function() {
                project1Init($("#project1 tbody"),Handlebars.compile($("#project1Template").html()));
            });
            $("body").on("click", "div[data-tab=project2]", function() {
                runProjectInit($("#project2 tbody"),Handlebars.compile($("#project2Template").html()));
            });
            $("body").on("click", "div[data-tab=project3]", function() {
                projectInit(3,$("#project3 tbody"),Handlebars.compile($("#project3Template").html()));
            });
            $("body").on("click", "div[data-tab=profile]", function() {
                var account = getMember().account;
                var fileName = "";
                var bidderInfo = {};
                $.ajax({
                    url: "/bidderInfo/getMemberInfo/"+getMember().id,
                    type: "GET",
                    async: false,
                    contentType: "application/json",
                    success:function(e) {
                        if(e.status == 200){
                            bidderInfo = e.data;
                        }else{
                            alert("获取企业信息失败："+e.message);
                        }
                    }
                });

                var qualificationCertificate01Name = "";
                var qualificationCertificate02Name = "";
                var qualificationCertificate03Name = "";
                var ids = "";
                if(account.accountCodeFileId !=null && account.accountCodeFileId !=""){
                    ids = account.accountCodeFileId.split(",");
                }
                if(bidderInfo.qualificationCertificate01 !=null && bidderInfo.qualificationCertificate01 !=""){
                    if(ids.length>0) ids+=",";
                    ids += bidderInfo.qualificationCertificate01.split(",");
                }
                if(bidderInfo.qualificationCertificate02 !=null && bidderInfo.qualificationCertificate02 !=""){
                    if(ids.length>0) ids+=",";
                    ids += bidderInfo.qualificationCertificate02.split(",");
                }
                if(bidderInfo.qualificationCertificate03 !=null && bidderInfo.qualificationCertificate03 !=""){
                    if(ids.length>0) ids+=",";
                    ids += bidderInfo.qualificationCertificate03.split(",");
                }
                if(ids){
                    $.ajax({
                        url: "/file/list2/"+ids,
                        type: "GET",
                        async: false,
                        contentType: "application/json",
                        success:function(e) {
                            if(e.status == 200){
                                for(var i=0;i<e.data.length;i++){
                                    var p = "<p><a style=\"padding:5px 10px; background:#2196F3; color:white; border:none; cursor:pointer; text-decoration:none;font-size: 13px;\" target=\"_blank\" href='/file/preview/"+e.data[i].id+"'>"+e.data[i].name+"（"+e.data[i].fileSize+"）<span onclick='deleteUploadFileInfo(\""+e.data[i].id+"\",\"uploadName\")' class='delete"+e.data[i].id+"' style='background-color: red;width: 15px;height: 16px;display: none;padding: 0;text-align: center;vertical-align: middle;border-radius: 15%;line-height: 15px;'>×</span></a></p>";
                                    if(account.accountCodeFileId !=null &&
                                        account.accountCodeFileId !="" &&
                                        (","+account.accountCodeFileId+",").indexOf(","+e.data[i].id+",")>-1){
                                        fileName+=p
                                    }else if(bidderInfo.qualificationCertificate01 !=null &&
                                        bidderInfo.qualificationCertificate01 !="" &&
                                        (","+bidderInfo.qualificationCertificate01+",").indexOf(","+e.data[i].id+",")>-1){
                                        qualificationCertificate01Name+=p
                                    }else if(bidderInfo.qualificationCertificate02 !=null &&
                                        bidderInfo.qualificationCertificate02 !="" &&
                                        (","+bidderInfo.qualificationCertificate02+",").indexOf(","+e.data[i].id+",")>-1){
                                        qualificationCertificate02Name+=p
                                    }else if(bidderInfo.qualificationCertificate03 !=null &&
                                        bidderInfo.qualificationCertificate03 !="" &&
                                        (","+bidderInfo.qualificationCertificate03+",").indexOf(","+e.data[i].id+",")>-1){
                                        qualificationCertificate03Name+=p
                                    }
                                }
                            }else{
                                alert("获取文件信息失败："+e.message);
                            }
                        }
                    });
                }

                var data = {
                    id:bidderInfo.id,
                    companyName:account.accountName,
                    creditCode:account.accountCode,
                    contactPerson:account.member,
                    contactPhone:account.phone,
                    contactEmail:account.email,
                    accountMoney:account.accountMoney,
                    fileName:fileName,
                    fileId:account.accountCodeFileId,
                    memberType:bidderInfo.memberType,
                    isCheck:bidderInfo.isCheck,
                    accountUser:bidderInfo.member.name,
                    idCard:bidderInfo.idCard,
                    remark:account.remark,
                    notCheckShow:bidderInfo.notCheckShow,
                    qualificationCertificate01:bidderInfo.qualificationCertificate01,
                    qualificationCertificate01Name:qualificationCertificate01Name,
                    qualificationCertificate02:bidderInfo.qualificationCertificate02,
                    qualificationCertificate02Name:qualificationCertificate02Name,
                    qualificationCertificate03:bidderInfo.qualificationCertificate03,
                    qualificationCertificate03Name:qualificationCertificate03Name
                };
                showInfo(data);
            });

            $("#accountState").click(function(){
                alert($(this).attr("data-info"));
            })
            $("input[value=0]").click(function(){
                $("#type1").show();
                $("#type2").hide();
            })
            $("input[value=1]").click(function(){
                $("#type1").hide();
                $("#type2").show();
            })
            uploadFileInfo("fileUpload","accountCodeFileId");
            uploadFileInfo("fileUpload2","qualificationCertificate01");
            uploadFileInfo("fileUpload3","qualificationCertificate01_01");
            uploadFileInfo("fileUpload4","qualificationCertificate02");
            uploadFileInfo("fileUpload5","qualificationCertificate03");

            function projectInit(state,tbody,template){
                $.ajax({
                    url: "/project/reviewEndProject",
                    type: "POST",
                    data: JSON.stringify({"state":state,"projectRegisters":{"state":1}}),
                    contentType: "application/json",
                    success:function(e) {
                        if(e.status == 200){
                            var newTemplate = template(e.data);
                            tbody.html(newTemplate);
                        }else{
                            alert("获取项目列表失败："+e.message);
                        }
                    }
                });
            }

            function runProjectInit(tbody,template){
                $.ajax({
                    url: "/project/runProject",
                    type: "POST",
                    contentType: "application/json",
                    success:function(e) {
                        if(e.status == 200){
                            e.data.accountId = getMember().account.id;
                            var newTemplate = template(e.data);
                            tbody.html(newTemplate);
                        }else{
                            alert("获取项目列表失败："+e.message);
                        }
                    }
                });
            }

            function project1Init(tbody,template){
                $.ajax({
                    url: "/project/listProject1",
                    type: "POST",
                    contentType: "application/json",
                    success:function(e) {
                        if(e.status == 200){
                            var newTemplate = template(e.data);
                            tbody.html(newTemplate);
                        }else{
                            alert("获取已报名项目列表失败："+e.message);
                        }
                    }
                });
            }

        })

        function availableInit(state,tbody,template){
            var projectName = $("#projectNameSearch").val();
            var projectCode = $("#projectCodeSearch").val();
            var enrollEndDate = $("#enrollEndDateSearch").val();
            var data = {"state":state};
            if(projectName){
                data["projectName"] = projectName;
            }
            if(projectCode){
                data["projectCode"] = projectCode;
            }
            if(enrollEndDate){
                data["enrollEndDateSearch"] = enrollEndDate;
            }
            var page = "";
            var pageInfo = localStorage.getItem('page');
            if(pageInfo){
                page="?page="+pageInfo;
            }
            $.ajax({
                url: "/project/listAvailable"+page,
                type: "POST",
                data: JSON.stringify(data),
                contentType: "application/json",
                success:function(e) {
                    if(e.status == 200){
                        var newTemplate = template(e.data);
                        tbody.html(newTemplate);
                        pageButton(e.data,"pageInfo2","pageThead2");
                    }else{
                        alert("获取可以报名项目列表失败："+e.message);
                    }
                }
            });
        }
        function initPageShow(data,pageName){
            if(pageName=="pageInfo2"){
                availableInit(1,$("#available tbody"),Handlebars.compile($("#availableTemplate").html()));
            }else{
                applyingInit(1,$("#applying tbody"),Handlebars.compile($("#applyingTemplate").html()));
            }
        }
        function applyingInit(state,tbody,template){
            var page = "";
            var pageInfo = localStorage.getItem('page');
            if(pageInfo){
                page="?page="+pageInfo;
            }
            $.ajax({
                url: "/projectRegister/listApplying"+page,
                type: "POST",
                data: JSON.stringify({"state":state}),
                contentType: "application/json",
                success:function(e) {
                    if(e.status == 200){
                        var newTemplate = template(e.data);
                        tbody.html(newTemplate);
                        pageButton(e.data);
                    }else{
                        alert("获取正在报名项目列表失败："+e.message);
                    }
                }
            });
        }
        function saveAccount(){
            var editCompanyName = $("#editCompanyName").val();
            var editCreditCode = $("#editCreditCode").val();
            var editContactPerson = $("#editContactPerson").val();
            var editContactPhone = $("#editContactPhone").val();
            var editContactEmail = $("#editContactEmail").val();
            var memberType = $("input[name=memberType]:checked").val();
            var accountCodeFileId = $("#fileUpload").attr("data-file-id");
            if(!editCompanyName || !editCreditCode || !editContactPerson || !editContactPhone || !memberType || !accountCodeFileId) {
                alert("请填写带 * 字段为必填项！");
                return ;
            }else if(!regBox.regMobilePhone.regEx.test(editContactPhone)){
                alert(regBox.regMobilePhone.message);
                return ;
            }else if(!regBox.regEmail.regEx.test(editContactEmail)){
                alert(regBox.regEmail.message);
                return ;
            }
            var idCard="";
            var qualificationCertificate01="";
            var qualificationCertificate02 = "";
            var qualificationCertificate03 = "";
            var accountUser = "";
            var accountUser2 = "";
            var qualificationCertificate01Show = "";
            if(memberType=='0'){
                // 法人
                accountUser = $("input[name=accountUser]").val();
                accountUser2 = accountUser;
                idCard = $("input[name=idCard]").val();
                qualificationCertificate01Show = $("#qualificationCertificate01").html();
                qualificationCertificate01 = $("#fileUpload2").attr("data-file-id");
                if(!accountUser || !idCard || !qualificationCertificate01) {
                    alert("请填写带 * 字段为必填项！");
                    return ;
                }
                if(!regBox.regIdCard.regEx.test(idCard)){
                    alert(regBox.regIdCard.message);
                    return ;
                }
            }else{
                // 授权代表人
                accountUser = $("input[name=accountUser2]").val();
                idCard = $("input[name=idCard2]").val();
                qualificationCertificate01Show = $("#qualificationCertificate01_01").html();
                qualificationCertificate01 = $("#fileUpload3").attr("data-file-id");
                qualificationCertificate02 = $("#fileUpload4").attr("data-file-id");
                qualificationCertificate03 = $("#fileUpload5").attr("data-file-id");
                if(!accountUser || !idCard || !qualificationCertificate01 || !qualificationCertificate02 || !qualificationCertificate03) {
                    alert("请填写带 * 字段为必填项！");
                    return;
                }
                if(!regBox.regIdCard.regEx.test(idCard)){
                    alert(regBox.regIdCard.message);
                    return;
                }
            }

            var account = {id:getMember().account.id,accountName:editCompanyName,accountUser:accountUser2,accountUserId:idCard,accountType:"0",accountCode:editCreditCode,member:editContactPerson,phone:editContactPhone,email:editContactEmail,accountCodeFileId:accountCodeFileId,ext5:$("#creditCode").text(),remark:$("#remark").val()};
            var member = {id:getMember().id,name:accountUser,account:account};
            var data = {id:$("#companyInfoForm").attr("data-id"),
                member:member,
                notCheckShow:$("#idCard").text(),
                memberType:memberType,
                idCard:idCard,
                qualificationCertificate01:qualificationCertificate01,
                qualificationCertificate02:qualificationCertificate02,
                qualificationCertificate03:qualificationCertificate03};
            $.ajax({
                url: "/bidderInfo/update",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success:function(e) {
                    if(e.status == 200){
                        var data2 = {
                            id:$("#companyInfoForm").attr("data-id"),
                            companyName:account.accountName,
                            creditCode:account.accountCode,
                            contactPerson:account.member,
                            contactPhone:account.phone,
                            contactEmail:account.email,
                            accountMoney:account.accountMoney,
                            fileName:$("#accountCodeFileId").html(),
                            fileId:account.accountCodeFileId,
                            memberType:data.memberType,
                            isCheck:'0',
                            remark:account.remark,
                            accountUser:data.member.name,
                            idCard:data.idCard,
                            notCheckShow:data.notCheckShow,
                            qualificationCertificate01:data.qualificationCertificate01,
                            qualificationCertificate01Name: qualificationCertificate01Show,
                            qualificationCertificate02:data.qualificationCertificate02,
                            qualificationCertificate02Name:$("#qualificationCertificate02").html(),
                            qualificationCertificate03:data.qualificationCertificate03,
                            qualificationCertificate03Name:$("#qualificationCertificate03").html()
                        };
                        showInfo(data2);
                        verifyLogin(); // 更新在线人员信息
                        alert('企业信息已提交审核人员审核，审核通过后可进行项目报名！');
                        // 切换回显示模式
                        document.getElementById('companyInfoDisplay').style.display = 'block';
                        document.getElementById('companyInfoForm').style.display = 'none';
                    }else{
                        alert("保存失败："+e.message);
                    }
                }
            });
        };

        function showInfo(data){
            $("#companyInfoForm").attr("data-id",data.id);
            $("#companyName").text(data.companyName);
            $("#creditCode").text(data.creditCode);
            $("#contactPerson").text(data.contactPerson);
            $("#contactPhone").text(data.contactPhone);
            $("#contactEmail").text(data.contactEmail);
            $("#accountMoney").text(data.accountMoney);
            $("#contactRemark").text(data.remark);
            $("#remark").val(data.remark);
            $("#certificateFiles").html(data.fileName.replaceAll("display: inline-block;","display: none;").replaceAll("class","data-delete"));
            $("#accountCodeFileId").html(data.fileName.replaceAll("display: none;","display: inline-block;").replaceAll("uploadName","fileUpload"));
            $("#fileUpload").attr("data-file-id",data.fileId);

            if(data.memberType=="0"){
                // 法人
                $("#memberType01").show();
                $("input[name=memberType][value='0']").attr("checked","checked");
                $("#type1").show();
                $("#type2").hide();
                $("#accountUser").text(data.accountUser);
                $("input[name=accountUser]").val(data.accountUser);
                $("#idCard").text(data.idCard);
                $("input[name=idCard]").val(data.idCard);
                $("#qualificationCertificate01").html(data.qualificationCertificate01Name.replaceAll("display: none;","display: inline-block;").replaceAll("uploadName","fileUpload2"));
                $("#fileUpload2").attr("data-file-id",data.qualificationCertificate01);
                $("#qualificationCertificate01Show").html(data.qualificationCertificate01Name.replaceAll("display: inline-block;","display: none;").replaceAll("class","data-delete"));

                $("#memberType02").hide();
                $("#accountUser2").text("");
                $("input[name=accountUser2]").val("");
                $("#idCard2").text("");
                $("input[name=idCard2]").val("");
                $("#qualificationCertificate01_01").html("");
                $("#fileUpload3").attr("data-file-id","");
                $("#qualificationCertificate01_01Show").html("");
                $("#qualificationCertificate02").html("");
                $("#fileUpload4").attr("data-file-id","");
                $("#qualificationCertificate02Show").html("");
                $("#qualificationCertificate03").html("");
                $("#fileUpload5").attr("data-file-id","");
                $("#qualificationCertificate03Show").html("");
            }else if(data.memberType=="1"){
                // 授权代表人
                $("#memberType01").hide();
                $("input[name=memberType][value='1']").attr("checked","checked");
                $("#type1").hide();
                $("#type2").show();
                $("#accountUser").text("");
                $("input[name=accountUser]").val("");
                $("#idCard").text("");
                $("input[name=idCard]").val("");
                $("#qualificationCertificate01").html("");
                $("#fileUpload2").attr("data-file-id","");
                $("#qualificationCertificate01Show").html("");

                $("#memberType02").show();
                $("#accountUser2").text(data.accountUser);
                $("input[name=accountUser2]").val(data.accountUser);
                $("#idCard2").text(data.idCard);
                $("input[name=idCard2]").val(data.idCard);
                $("#qualificationCertificate01_01").html(data.qualificationCertificate01Name.replaceAll("display: none;","display: inline-block;").replaceAll("uploadName","fileUpload3"));
                $("#fileUpload3").attr("data-file-id",data.qualificationCertificate01);
                $("#qualificationCertificate01_01Show").html(data.qualificationCertificate01Name.replaceAll("display: inline-block;","display: none;").replaceAll("class","data-delete"));
                $("#qualificationCertificate02").html(data.qualificationCertificate02Name.replaceAll("display: none;","display: inline-block;").replaceAll("uploadName","fileUpload4"));
                $("#fileUpload4").attr("data-file-id",data.qualificationCertificate02);
                $("#qualificationCertificate02Show").html(data.qualificationCertificate02Name.replaceAll("display: inline-block;","display: none;").replaceAll("class","data-delete"));
                $("#qualificationCertificate03").html(data.qualificationCertificate03Name.replaceAll("display: none;","display: inline-block;").replaceAll("uploadName","fileUpload5"));
                $("#fileUpload5").attr("data-file-id",data.qualificationCertificate03);
                $("#qualificationCertificate03Show").html(data.qualificationCertificate03Name.replaceAll("display: inline-block;","display: none;").replaceAll("class","data-delete"));
            }else{
                $("#memberType01").show();
                $("input[name=memberType][value='0']").attr("checked","checked");
                $("#type1").show();
                $("#type2").hide();
            }
            if(!data.memberType){
                $("#accountState").css({color:'red',cursor:'pointer'});
                $("#accountState").attr('data-info','由于系统升级为了保证企业信息的真实性，新增部分企业信息校验请先补全信息并审核通过后可报名项目，谢谢配合。');
                $("#accountState").html("（信息审核：<span style='background: red;color: #fff;padding: 5px 7px;border-radius: 5px;font-size: 12px;'>未审核</span>）");
            }else if(data.isCheck=='0'){
                $("#accountState").css({color:'#2196F3',cursor:'pointer'});
                $("#accountState").attr('data-info','企业信息已提交审核人员审核中，请耐心等待。');
                $("#accountState").html("（信息审核：<span style='background: #2196F3;color: #fff;padding: 5px 7px;border-radius: 5px;font-size: 12px;'>审核中</span>）");
            }else if(data.isCheck=='1'){
                $("#accountState").css({color:'#4CAF50',cursor:'pointer'});
                $("#accountState").attr('data-info','企业信息已通过审核，可以报名项目。');
                $("#accountState").html("（信息审核：<span style='background: #4CAF50;color: #fff;padding: 5px 7px;border-radius: 5px;font-size: 12px;'>审核通过</span>）");
            }else if(data.isCheck=='2'){
                $("#accountState").css({color:'red',cursor:'pointer'});
                $("#accountState").attr('data-info','不通过原因：'+data.notCheckShow);
                $("#accountState").html("（信息审核：<span style='background: red;color: #fff;padding: 5px 7px;border-radius: 5px;font-size: 12px;'>查看不通过原因</span>）");
            }
        }

        // 显示报名结果弹窗
        function showApplicationModal2(projectName,id) {

            $.ajax({
                url: "/projectRegister/getProject/"+id+"/1",
                type: "GET",
                contentType: "application/json",
                success:function(e) {
                    if(e.status == 200){
                        // 设置弹窗标题
                        document.getElementById('modalTitle2').textContent = projectName + ' - 评审结果';

                        // 填充模拟数据
                        const tbody = document.getElementById('modalApplicationTable2');
                        tbody.innerHTML = '';

                        // 模拟3个报名单位
                        var companies = [{name: '没有评审结果'}];
                        if(e.data.length>0){
                            companies = [];
                            for(var i=0;i<e.data.length;i++){
                                var accountName = "";
                                var contact = "";
                                var phone = "";
                                var account = e.data[i].member.account;
                                if(account!=null){
                                    if(account.accountName!=null){
                                        accountName =account.accountName;
                                    }
                                    if(account.member!=null){
                                        contact =account.member;
                                    }
                                    if(account.phone!=null){
                                        phone =account.phone;
                                    }
                                }
                                companies.push({name: accountName, contact: contact, phone: phone, winBidState: e.data[i].winBidState})
                            }
                        }
                        companies.forEach(company => {
                            const row = document.createElement('tr');
                            row.style.border = '1px solid #ddd';
                            row.innerHTML = `<td colspan="5" style="padding:10px;">没有评审结果</td>`;
                            if(e.data.length>0){
                                row.innerHTML = `
                                    <td style="padding:10px;">${company.name}</td>
                                    <td style="padding:10px;">${company.contact}</td>
                                    <td style="padding:10px;">${company.phone}</td>
                                    <td style="padding:10px;">${company.winBidState=="1"?'中标':(company.winBidState=="2"?'未中标':'未公布')}</td>
                                `;
                            }
                            tbody.appendChild(row);
                        });
                        // 显示弹窗
                        document.getElementById('applicationModal2').style.display = 'block';
                    }else{
                        alert("获取项目列表失败："+e.message);
                    }
                }
            });

        }

        // 显示报名结果弹窗
        function showProgress(projectName,id) {
            alert(config.refundReason);
        }
        // 显示报名结果弹窗
        function signUp(id,downUrl,oldSuppliers) {
            if(downUrl){
                if(confirm('是否下载告知书和登记表。请仔细阅读附件的廉洁告知书，补充完整登记表信息盖章和报名资料一起在【我的信息】中上传！')) {
                    window.open(downUrl, '_blank');
                }
            }
            if(confirm('请确认经办人是否在职，如不在职，应更改经办人并提交新的法定代表人授权函、授权代表身份证及社保，审核通过后才能报名！')) {
                var account = getMember().account;
                if(!account.accountName || !account.accountCode || !account.member || !account.phone || !account.email || !account.accountCodeFileId){
                    alert("请在【我的信息】中完善企业信息并审核通过后再进行报名！");
                    $("#myInfo").click();
                    return ;
                }
                if(oldSuppliers){
                    //前期供应商
                    if((","+oldSuppliers+",").indexOf(","+account.accountName+",")>-1){
                        alert("工程项目报名失败：检测到公司已参与前期工程的投入。如有疑问，请拨打"+config.consultPhone.replaceAll("&#10;","，"));
                        return ;
                    }
                }
                var data = {"project":{"id":id}};
                projectRegister(data,1);
            }
        }


        // 显示报名结果弹窗
        function signUp2(id) {
            if(confirm('是否已了解退费流程，确定重新报名吗？')) {
                var data = {"project":{"id":id}};
                projectRegister(data,2);
            }
        }
        // 显示报名结果弹窗
        function signUp3(id) {
            if(confirm('确认重新审核报名文件吗？')) {
                var data = {"project":{"id":id}};
                projectRegister(data,2);
            }
        }

        function application(href){
            window.location.href = href;
        }

        function projectRegister(data,state){
            $.ajax({
                url: "/projectRegister/create",
                type: "POST",
                data: JSON.stringify(data),
                contentType: "application/json",
                success:function(e) {
                    if(e.status == 200){
                        window.location.href = "/Application.html?id="+e.data.project.id+"&pid="+e.data.id;
                    }else{
                        if(e.message.indexOf("【我的信息】")>-1){
                            alert(e.message);
                            $("#myInfo").click();
                            return;
                        }
                        alert("报名失败："+e.message);
                    }
                }
            });
        }

        // 关闭弹窗
        function closeModal2() {
            document.getElementById('applicationModal2').style.display = 'none';
        }

        function myInfoUpdate(){
            $("div[data-tab=profile]").click();
        }
    </script>
    <!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>
