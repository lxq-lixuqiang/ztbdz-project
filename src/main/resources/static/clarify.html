<!doctype html>
<html><!-- InstanceBegin template="/Templates/001.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
    <meta charset="utf-8">
    <!-- InstanceBeginEditable name="doctitle" -->
    <title>澄清页面</title>
    <!-- InstanceEndEditable -->
    <!-- InstanceBeginEditable name="head" -->
    <script src="/js/db-connection.js"></script>
    <style>
        .evaluation-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .progress-bar {
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f5f5f5;
            margin-bottom: 20px;
        }
        .progress-step {
            display: flex;
            align-items: center;
            padding: 0 20px;
        }
        .progress-step.active {
            font-weight: bold;
            color: #2196F3;
        }
        .progress-arrow {
            margin: 0 10px;
            font-size: 20px;
        }
        .review-content {
            display: flex;
            flex: 1;
            gap: 20px;
        }
        .file-viewer {
            width: 600px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .pdf-container {
            height: 600px;
            border: 1px solid #eee;
            margin-bottom: 10px;
            overflow: auto;
        }
        .pdf-toolbar {
            display: flex;
            gap: 10px;
        }
        .pdf-toolbar button {
            padding: 5px 10px;
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        .review-panel {
            flex: 1;
            border: 1px solid #ddd;
            padding: 20px;
        }
        .criteria-section {
            display: none;
        }
        .criteria-section.active {
            display: block;
        }
    </style>
    <!-- InstanceEndEditable -->
</head>

<body>
<!-- 不可编辑的顶部区域 -->
<div style="width:1040px; height:120px; background:#f0f0f0; position:relative; display:flex; justify-content:space-between; align-items:center; padding:0 50px;">
    <div style="font-size:28px; font-weight:bold;">中天阳光AI智能化评标系统</div>
    <div style="display:flex; gap:30px;">
        <a href="index.html" style="text-decoration:none; color:#333;">返回首页</a>
        <a href="login.html" style="text-decoration:none; color:#333;">登录</a>
        <a href="login-out.html" style="text-decoration:none; color:#333;">退出</a>
    </div>
</div>

<!-- 可编辑的主要内容区域 -->
<!-- InstanceBeginEditable name="content" -->
<div style="width:1040px; min-height:calc(100vh - 120px);">
    <div class="evaluation-container">
        <!-- 评审进度导航条 -->
        <div class="progress-bar">
            <div id="step-qualification" class="progress-step"></div>
        </div>

        <!-- 评审内容区域 -->
        <div class="review-content">
            <!-- 左侧文件展示区 -->
            <div class="file-viewer">
                <h3>评审界面</h3>
                <div style="margin-bottom: 15px;">
                    <label for="supplierSelect" style="margin-right: 10px;">选择专家:</label>
                    <select id="supplierSelect" style="padding: 5px; min-width: 200px;" onchange="switchSupplier(this.value)">
                        <option value="">-- 请选择专家 --</option>
                    </select>
                </div>
                <div class="pdf-container" id="pdf-viewer" style="overflow: hidden;">
                    <p style="text-align:center;">请选择专家查看评审内容进度</p>
                    <iframe width='100%' height='100%' style="display: none;border-width:0px;" id="iframeInfo"></iframe>
                </div>
                <div class="pdf-toolbar">
                    <button onclick="zoomIn()">放大</button>
                    <button onclick="zoomOut()">缩小</button>
                    <button onclick="openInNewWindow()">弹出</button>
                </div>
            </div>

            <!-- 右侧评审标准区 -->
            <div class="review-panel">
                <h3>澄清</h3>
                <div id="project" style="margin-bottom:10px;" >
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                        <tr style="background:#f5f5f5;">
                            <th style="padding:10px; border:1px solid #ddd;">序号</th>
                            <th style="padding:10px; border:1px solid #ddd;">内容</th>
                            <th style="padding:10px; border:1px solid #ddd;">应答状态</th>
                            <th style="padding:10px; border:1px solid #ddd;">操作</th>
                        </tr>
                        </thead>
                        <tbody>

                        </tbody>
                    </table>
                </div>
                <div style="display:flex; gap:10px;margin-bottom:15px;">
                    <button type="button" style="padding:10px 20px; background:#4CAF50; color:white; border:none; cursor:pointer; font-size:16px;">
                        澄清
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="plugin/jquery-3.3.1.min.js" type="text/javascript"></script>
<script src="config/token.js" type="text/javascript"></script>
<script>
    verifyLogin();

    var urlAccountId = new URLSearchParams(window.location.search).get("id");
    var urlProjectId = new URLSearchParams(window.location.search).get("projectId");
    var urlIsExpert = new URLSearchParams(window.location.search).get("isExpert");
    var account;

    $(function() {
        initData();

        function initData(){
            $.ajax({
                url: "/account/get/" + urlAccountId,
                type: "GET",
                contentType: "application/json",
                success: function (e) {
                    if(e.status == 200){
                        account = e.data;
                        $("#step-qualification").html("供应商："+e.data.accountName);
                    }else{
                        alert(e.message);
                    }
                }
            });

            $.ajax({
                url: "/expertInfo/get/"+urlProjectId,
                type: "GET",
                contentType: "application/json",
                success:function(e) {
                    if(e.status == 200){
                        if(e.data.selectExpert.length>0){
                            for(var i=0;i<e.data.selectExpert.length;i++){
                                var selectExpert = e.data.selectExpert[i];
                                var id =selectExpert.member.id;
                                var name = selectExpert.member.name;

                                var option = document.createElement("option");
                                option.setAttribute("value",id);
                                option.innerText=name;
                                document.getElementById('supplierSelect').appendChild(option)
                            }
                        }
                    }else{
                        alert(e.message);
                    }
                }
            });

        }
    });

    // 切换供应商
    function switchSupplier(memberId) {
        getPrintContents(memberId,urlProjectId);
    }
    var scale = 0.5;
    var openPrintHTML;
    function getPrintContents(memberId,projectId){
        $("#iframeInfo").contents().find("body").html("");
        verifyLogin();
        $.ajax({
            url: "/resultReport/getPrintContents/"+memberId+"/"+projectId,
            type: "GET",
            contentType: "application/json",
            success:function(e) {
                if(!e.data){
                    e.data="";
                }
                $("#pdf-viewer>p").hide();
                openPrintHTML = printHTML(e.data);
                $("#iframeInfo").contents().find("body").attr("style","transform:scale("+scale+");transform-origin: 0% 0%;").html(openPrintHTML);
                $("#iframeInfo").show();

            }
        });
    }

    // 放大
    function zoomIn() {
        scale += 0.25;
        $("#iframeInfo").contents().find("body").attr("style","transform:scale("+scale+");transform-origin: 0% 0%;");
    }

    // 缩小
    function zoomOut() {
        if (scale > 0.25) {
            scale -= 0.25;
            $("#iframeInfo").contents().find("body").attr("style","transform:scale("+scale+");transform-origin: 0% 0%;");
        }
    }
    //弹出
    function openInNewWindow(){
        const printWindow = window.open('', '_blank');
        printWindow.document.write(openPrintHTML);
    }

    function printHTML(printContent){
        var content = `<html>
                    <head>
                        <title>评审页面</title>
                        <style>
                        .evaluation-container {
                            display: flex;
                            flex-direction: column;
                        }
                        .progress-bar {
                            height: 80px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            background: #f5f5f5;
                            margin-bottom: 20px;
                        }
                        .progress-step {
                            display: flex;
                            align-items: center;
                            padding: 0 20px;
                        }
                        .progress-step.active {
                            font-weight: bold;
                            color: #2196F3;
                        }
                        .progress-arrow {
                            margin: 0 10px;
                            font-size: 20px;
                        }
                        .review-content {
                            display: flex;
                            flex: 1;
                            gap: 20px;
                        }
                        .file-viewer {
                            width: 600px;
                            border: 1px solid #ddd;
                            padding: 10px;
                        }
                        .pdf-container {
                            height: 600px;
                            border: 1px solid #eee;
                            margin-bottom: 10px;
                            overflow: auto;
                        }
                        .pdf-toolbar {
                            display: flex;
                            gap: 10px;
                        }
                        .pdf-toolbar button {
                            padding: 5px 10px;
                            background: #4CAF50;
                            color: white;
                            border: none;
                            cursor: pointer;
                        }
                        .review-panel {
                            flex: 1;
                            border: 1px solid #ddd;
                            padding: 20px;
                        }
                        .criteria-section {
                            display: none;
                        }
                        .criteria-section.active {
                            display: block;
                        }
                    </style>
                    </head>
                    <body>
                        <div id="readDiv" style="opacity: 0;z-index:9999;position: absolute;left:0;top:0;">
                            ${printContent}
                        </div>
                        ${printContent}
                    </body>
                </html>`;
        return content;
    }

</script>
</body>
<!-- InstanceEnd --></html>
